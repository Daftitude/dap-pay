<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DAP‚ö°Pay | Sign Up</title>

  <!-- External CSS -->
  <link rel="stylesheet" href="css/style.css">

  <!-- Responsive -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- FontAwesome for Eye Icon -->
  <script src="https://kit.fontawesome.com/YOUR_FONT_AWESOME_KIT.js" crossorigin="anonymous"></script> 
  <!-- (Replace YOUR_FONT_AWESOME_KIT with a real kit or local icons if needed) -->
</head>

<body>

<!-- Particle Background -->
<div id="particles-js"></div>

<!-- ======= Navbar ======= -->
<nav class="navbar">
  <div class="nav-container">
    <div class="dap-logo">DAP‚ö°Pay</div>
    <div class="hamburger" onclick="toggleMenu()">‚ò∞</div>
    <div class="nav-links" id="navLinks">
      <a href="login.html">üîë Login</a>
      <a href="signup.html">üÜï Sign Up</a>
    </div>
  </div>
</nav>

<!-- ======= Signup Content ======= -->
<div class="dashboard-wrapper">
  <div class="form-card">

    <!-- Step Progress -->
    <h2 id="stepProgress" style="margin-bottom: 20px;">Step 1 of 6</h2>

    <form id="signupForm">

      <!-- Steps -->
      <div class="step" id="step1">
        <input type="text" id="username" class="input-field" placeholder="üî• Choose a Username" required>
      </div>

      <div class="step" id="step2" style="display:none;">
        <input type="text" id="emailPhone" class="input-field" placeholder="üìß Enter Email or üì± Phone" required>
      </div>

      <div class="step" id="step3" style="display:none;">
        <input type="text" id="firstName" class="input-field" placeholder="üë§ First Name" required>
        <input type="text" id="lastName" class="input-field" placeholder="üë§ Last Name" required>
      </div>

      <div class="step" id="step4" style="display:none;">
        <input type="number" id="dobMonth" class="input-field" placeholder="üìÖ Month (MM)" min="1" max="12" required>
        <input type="number" id="dobDay" class="input-field" placeholder="üìÖ Day (DD)" min="1" max="31" required>
        <input type="number" id="dobYear" class="input-field" placeholder="üìÖ Year (YYYY)" min="1900" required>
      </div>

      <div class="step" id="step5" style="display:none;">
        <input type="text" id="address" class="input-field" placeholder="üè† Address (Optional)">
      </div>

      <div class="step" id="step6" style="display:none;">
        <div style="position: relative;">
          <input type="password" id="password" class="input-field" placeholder="üîí Create Password" required>
          <i class="fas fa-eye toggle-password" id="togglePassword" onclick="togglePassword('password', 'togglePassword')" style="position:absolute; right:20px; top:15px; cursor:pointer;"></i>
        </div>
        <div style="position: relative; margin-top:10px;">
          <input type="password" id="confirmPassword" class="input-field" placeholder="üîí Confirm Password" required>
          <i class="fas fa-eye toggle-password" id="toggleConfirmPassword" onclick="togglePassword('confirmPassword', 'toggleConfirmPassword')" style="position:absolute; right:20px; top:15px; cursor:pointer;"></i>
        </div>
      </div>

      <!-- Buttons -->
      <div style="margin-top: 20px;">
        <button type="button" class="glow-btn secondary" onclick="prevStep()" id="backBtn" style="display:none;">‚¨ÖÔ∏è Back</button>
        <button type="button" class="glow-btn" onclick="nextStep()">Continue ‚û°Ô∏è</button>
      </div>

    </form>

  </div>
</div>

<!-- ======= Scripts ======= -->
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script src="js/toast.js"></script>

<script>
// Particles
particlesJS('particles-js', { /* same settings as before */ });

// Mobile Menu
function toggleMenu() {
  document.getElementById('navLinks').classList.toggle('show');
}

// Show/Hide Password
function togglePassword(inputId, iconId) {
  const input = document.getElementById(inputId);
  const icon = document.getElementById(iconId);
  if (input.type === "password") {
    input.type = "text";
    icon.classList.remove('fa-eye');
    icon.classList.add('fa-eye-slash');
  } else {
    input.type = "password";
    icon.classList.remove('fa-eye-slash');
    icon.classList.add('fa-eye');
  }
}

// Multi-Step Logic
let currentStep = 1;
const totalSteps = 6;

function nextStep() {
  if (!validateStep(currentStep)) return;
  document.getElementById(`step${currentStep}`).style.display = 'none';
  currentStep++;
  if (currentStep > totalSteps) {
    saveUser();
    return;
  }
  document.getElementById(`step${currentStep}`).style.display = 'block';
  document.getElementById('stepProgress').textContent = `Step ${currentStep} of ${totalSteps}`;
  document.getElementById('backBtn').style.display = (currentStep > 1) ? 'inline-block' : 'none';
}

function prevStep() {
  document.getElementById(`step${currentStep}`).style.display = 'none';
  currentStep--;
  document.getElementById(`step${currentStep}`).style.display = 'block';
  document.getElementById('stepProgress').textContent = `Step ${currentStep} of ${totalSteps}`;
  document.getElementById('backBtn').style.display = (currentStep > 1) ? 'inline-block' : 'none';
}

function validateStep(step) {
  if (step === 1 && !document.getElementById('username').value.trim()) {
    showToast('‚ùå Please enter a username.', 'error');
    return false;
  }
  if (step === 2 && !document.getElementById('emailPhone').value.trim()) {
    showToast('‚ùå Please enter your email or phone.', 'error');
    return false;
  }
  if (step === 3 && (!document.getElementById('firstName').value.trim() || !document.getElementById('lastName').value.trim())) {
    showToast('‚ùå Please fill in both names.', 'error');
    return false;
  }
  if (step === 4) {
    const year = parseInt(document.getElementById('dobYear').value);
    if (new Date().getFullYear() - year < 18) {
      showToast('‚ö†Ô∏è Must be 18+ to join.', 'error');
      return false;
    }
  }
  if (step === 6) {
    const pass = document.getElementById('password').value;
    const confirmPass = document.getElementById('confirmPassword').value;
    if (!pass || pass.length < 6) {
      showToast('‚ùå Password too short.', 'error');
      return false;
    }
    if (pass !== confirmPass) {
      showToast('‚ùå Passwords don‚Äôt match.', 'error');
      return false;
    }
  }
  return true;
}

function saveUser() {
  const user = {
    username: document.getElementById('username').value.trim(),
    emailPhone: document.getElementById('emailPhone').value.trim(),
    firstName: document.getElementById('firstName').value.trim(),
    lastName: document.getElementById('lastName').value.trim(),
    dob: `${document.getElementById('dobMonth').value}/${document.getElementById('dobDay').value}/${document.getElementById('dobYear').value}`,
    address: document.getElementById('address').value.trim(),
    password: document.getElementById('password').value.trim(),
    balance: 0
  };

  let users = JSON.parse(localStorage.getItem('users')) || [];
  let existing = users.find(u => u.username.toLowerCase() === user.username.toLowerCase());
  if (existing) {
    showToast('‚ùå Username already taken.', 'error');
    return;
  }

  users.push(user);
  localStorage.setItem('users', JSON.stringify(users));
  localStorage.setItem('currentUser', user.username);
  
  showToast('üéâ Account Created! Redirecting...');
  setTimeout(() => {
    window.location.href = "dashboard.html";
  }, 2000);
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DAP⚡Pay | Dashboard</title>

  <!-- External Styles -->
  <link rel="stylesheet" href="css/style.css">

  <!-- Responsive Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

<!-- Particle Background -->
<div id="particles-js"></div>

<!-- ======= Navbar ======= -->
<nav class="navbar">
  <div class="nav-container">
    <div class="dap-logo">DAP⚡Pay</div>
    <div class="hamburger" onclick="toggleMenu()">☰</div>
    <div class="nav-links" id="navLinks">
      <a href="dashboard.html">🏠 Dashboard</a>
      <a href="add-funds.html">➕ Add Funds</a>
      <a href="balance.html">💰 Balance</a>
      <a href="pay-game.html">🎱 Pay Game</a>
      <a href="login.html" onclick="logout()">🚪 Logout</a>
    </div>
  </div>
</nav>

<!-- ======= Main Content ======= -->
<div class="dashboard-wrapper">

  <!-- Hero Welcome -->
  <div class="hero-section">
    <h1 class="hero-title">👋 Welcome back, <span id="userName"></span>!</h1>
    <p class="hero-subtitle">✅ Status: <span style="color: #0CC7F6;">Good Standing</span></p>
  </div>

  <!-- Wallet Balance -->
  <div class="balance-card">
    <h2 id="walletBalance">$0.00</h2>
    <p>Available Wallet Balance</p>
  </div>

  <!-- Last Payment Info -->
  <div class="form-card" style="margin-top: 20px; text-align: center;">
    <h3 style="color: #0CC7F6;">🧾 Last Payment</h3>
    <p id="lastPaymentInfo" style="color: #ccc;">No recent payments yet.</p>
  </div>

  <!-- Quick Stats -->
  <div class="form-card" style="margin-top: 20px;">
    <h3 style="color: #FFC857; text-align: center;">📊 Quick Stats</h3>
    <div style="text-align: center; color: #ccc; font-size: 1rem;">
      <p>🎱 Games Played: <span id="gamesPlayed">0</span></p>
      <p>🪑 Tables Paid: <span id="tablesPaid">0</span></p>
      <p>💵 Total Spent: $<span id="totalSpent">0.00</span></p>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="payment-options" style="margin-top: 40px;">
    <button onclick="location.href='pay-game.html'">🎱 Start New Game/Table ➡️</button>
    <button onclick="location.href='add-funds.html'">➕ Add Funds</button>
  </div>

  <!-- Transaction History -->
  <div class="transaction-history" style="margin-top: 40px;">
    <h3>Transaction History</h3>
    <div id="transactionList">No transactions yet.</div>
  </div>

  <!-- Logout -->
  <button class="logout-btn" onclick="logout()">🚪 Logout</button>

</div>

<!-- ======= Scripts ======= -->
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script src="JS/popup.js"></script>
<script src="JS/toast.js"></script>

<script>
// Particles Init
particlesJS('particles-js', {
  "particles": {
    "number": { "value": 80, "density": { "enable": true, "value_area": 800 }},
    "color": { "value": "#0CC7F6" },
    "shape": { "type": "circle" },
    "opacity": { "value": 0.4, "random": true },
    "size": { "value": 3, "random": true },
    "line_linked": { "enable": true, "distance": 150, "color": "#0CC7F6", "opacity": 0.3, "width": 1 },
    "move": { "enable": true, "speed": 1 }
  },
  "retina_detect": true
});

// Toggle Menu
function toggleMenu() {
  document.getElementById('navLinks').classList.toggle('show');
}

// Dashboard Logic
let users = JSON.parse(localStorage.getItem('users')) || [];
let currentUser = localStorage.getItem('currentUser');
if (!currentUser) {
  window.location.href = "login.html";
}
let user = users.find(u => u.username === currentUser);

// Update UI
document.getElementById('userName').textContent = currentUser;
document.getElementById('walletBalance').textContent = `$${user.balance.toFixed(2)}`;

// Show Last Payment
function updateLastPayment() {
  const history = JSON.parse(localStorage.getItem('paymentHistory')) || [];
  const userHistory = history.filter(tx => tx.username === currentUser);

  if (userHistory.length > 0) {
    const last = userHistory[userHistory.length - 1];
    document.getElementById('lastPaymentInfo').innerHTML = `
      🎱 ${last.type} - Table ${last.table}<br>
      💵 $${last.amount.toFixed(2)}<br>
      🕒 ${last.date}
    `;
  } else {
    document.getElementById('lastPaymentInfo').textContent = "No recent payments yet.";
  }
}
updateLastPayment();

// Load Transaction History
function loadTransactions() {
  const container = document.getElementById('transactionList');
  container.innerHTML = "";

  const history = JSON.parse(localStorage.getItem('paymentHistory')) || [];
  const userHistory = history.filter(tx => tx.username === currentUser);

  if (userHistory.length === 0) {
    container.innerHTML = "<p style='color: #ccc; text-align: center;'>No transactions yet.</p>";
    return;
  }

  userHistory.reverse().forEach(tx => {
    let div = document.createElement('div');
    div.className = 'transaction-item';
    div.innerHTML = `
      <span>🎱 ${tx.type} - Table ${tx.table}</span>
      <span>💵 $${tx.amount.toFixed(2)}</span>
    `;
    container.appendChild(div);
  });
}
loadTransactions();

// Quick Stats
function loadQuickStats() {
  const history = JSON.parse(localStorage.getItem('paymentHistory')) || [];
  const userHistory = history.filter(tx => tx.username === currentUser);

  let games = 0;
  let tables = 0;
  let spent = 0;

  userHistory.forEach(tx => {
    if (tx.type === 'Game') games++;
    if (tx.type === 'Table') tables++;
    spent += tx.amount;
  });

  document.getElementById('gamesPlayed').textContent = games;
  document.getElementById('tablesPaid').textContent = tables;
  document.getElementById('totalSpent').textContent = spent.toFixed(2);
}
loadQuickStats();

// Logout
function logout() {
  localStorage.removeItem('currentUser');
  window.location.href = "login.html";
}
</script>

</body>
</html>
